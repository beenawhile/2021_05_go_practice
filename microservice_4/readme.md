# Test

- 테스트 피라미드 개념 활용(Succeeding with Agile, Mike Cohn)
  - 가장 비용이 적게 드는(가장 빠른) 테스트인 단위 테스트(unit test)를 최하단
  - 서비스 수준의 통합테스트를 그 위에 놓음
  - 가장 값비싼 요소인 전체 시스템 테스트  
           UI  
         서비스  
       유닛 테스트
  - 피라미드 위로 갈수록 테스트 횟수는 줄어듬
  - 자동 테스트 초기에는 모든 테스트를 피라미드 상단에서 진행
    - 품질 측면에서는 효과 있었지만, 에러 있는 영역을 디버깅하는 프로세스가 매우 복잡하고 시간이 오래 걸림
  - out-in development 프로세스 : 저자가 선호하는 방법
    - 피라미드 위쪽에 있는 테스트를 작성
    - 작업중인 스토리의 기능을 결정한 다음 이 스토리에 대한 실패하는 테스트 작성
    - 그 다음으로 행위 기반 테스트에서 통과해야 하는 여러 단계에 맞춰 단위 테스트 및 코드를 구현

  - Bob Martin의 테스트 3가지 법칙(Clean Code)  
    1) 실제코드를 작성하기 전에 실패하는 단위 테스트를 먼저 작성
    2) 컴파일에 실패하지 않으면서 실패하기에 충분한 수준으로만 단위테스트 작성
    3) 현재 실패하는 테스트를 통과할 수 있는 수준으로만 실제 코드 작성
  - Go에서 마이크로서비스를 테스트하는 가장 효과적인 방법
    - HTTP 인터페이스를 통해 모든 테스트를 실행하려고 하는 함정에 빠지지 않는 것

  - go test 기본 커맨드
    - $go test -v -race 파일
    - -v : 상세 출력 형식, 테스트 성공하더라도 애플리케이션 출력한 모든 텍스트 보여줌
    - -race : 동시성 문제가 있는 버그를 발견하는 Go의 레이스 탐지기를 활성화함. 두 개의 Go 루틴이 동일한 변수에 동시에 접근하며 그 중 하나 이상이 쓰기 접근인 경우 데이터 레이스 발생
      - race 플래그는 테스트 실행에 크게 부담되지 않으므로 실행 시에 항상 추가하는 것이 좋음
    
